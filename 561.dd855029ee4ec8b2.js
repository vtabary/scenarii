(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[561],{6561:(Ie,we,Z)=>{"use strict";Z.r(we),Z.d(we,{FileManagerModule:()=>Tt});var H=Z(9808),T=Z(2382),Te=Z(1431),A=Z(5825),e=Z(1223),le=Z(8466),ce=Z(5243),De=Z(7688),v=Z(8675),ue=Z(4004);function te(n,i){1&n&&(e.ynx(0),e._uU(1," A file is currently loaded and used. You can configure the columns, "),e.TgZ(2,"a",3),e._uU(3,"run the scenarios"),e.qZA(),e._uU(4,", "),e.TgZ(5,"a",4),e._uU(6,"list all the scenarios"),e.qZA(),e._uU(7," or reset the progression using the button below. "),e.BQk())}function he(n,i){1&n&&e._uU(0," To start a test, you need to load a file. ")}let ge=(()=>{class n{constructor(t){this.isRunning=t.registryUpdated.pipe((0,v.O)(t.getAll()),(0,ue.U)(r=>r.length>0))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(le.z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-status"]],outputs:{isRunning:"isRunning"},decls:5,vars:4,consts:[[1,"mb-3","bg-blue-50","border-0","border-gray-800","p-3","rounded-md","shadow-sm","text-gray-800"],[4,"ngIf","ngIfElse"],["noFile",""],["routerLink","/run",1,"cursor-pointer","text-indigo-600","hover:text-indigo-500","focus-within:outline-none","focus-within:ring-2","focus-within:ring-offset-2","focus-within:ring-indigo-500"],["routerLink","/scenarios",1,"cursor-pointer","text-indigo-600","hover:text-indigo-500","focus-within:outline-none","focus-within:ring-2","focus-within:ring-offset-2","focus-within:ring-indigo-500"]],template:function(t,r){if(1&t&&(e.TgZ(0,"div",0),e.YNc(1,te,8,0,"ng-container",1),e.ALo(2,"async"),e.YNc(3,he,1,0,"ng-template",null,2,e.W1O),e.qZA()),2&t){const a=e.MAs(4);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,r.isRunning))("ngIfElse",a)}},directives:[H.O5,A.yS],pipes:[H.Ov],styles:["[_nghost-%COMP%]{display:contents}"]}),n})();var D=Z(7579),R=Z(727),J=Z(4482),N=Z(5403),L=Z(8421),M=Z(5032);const O=e.GuJ,U=Symbol("__destroy"),w=Symbol("__decoratorApplied");function x(n){return"string"==typeof n?Symbol(`__destroy__${n}`):U}function g(n,i){n[i]||(n[i]=new D.x)}function P(n,i){n[i]&&(n[i].next(),n[i].complete(),n[i]=null)}function z(n){n instanceof R.w0&&n.unsubscribe()}function ie(n,i){return function(){var t;if(n&&n.call(this),P(this,x()),i.arrayName)return function G(n){Array.isArray(n)&&n.forEach(z)}(this[i.arrayName]);if(i.checkProperties)for(const r in this)(null===(t=i.blackList)||void 0===t?void 0:t.includes(r))||z(this[r])}}var K=Z(801);const Ae=(n,i)=>t=>(i||(i=Object.keys(t.controls)),t&&t.controls&&i.some(a=>!n(t.controls[a]))?null:{atLeastOneOf:!0}),de=(n,i)=>t=>(i||(i=Object.keys(t.controls)),t&&t.controls&&i.filter(a=>!n(t.controls[a])).length>1?{onlyOneOf:!0}:null),_e=(n=[])=>(n=n.map(i=>i.toLocaleLowerCase()),i=>{const t=i.value;return 0===n.length||!t||n.includes(t.type.toLocaleLowerCase())?null:{requiredFileType:!0}});var ae=Z(3028),Oe=Z(8306);let qe=(()=>{class n{parseFile(t){return new Oe.y(r=>{(0,ae.parse)(t,{download:!1,header:!0,worker:!0,dynamicTyping:!1,delimiter:";",complete:a=>r.next(a.data),error:a=>r.error(a)})})}parseURL(t){return new Oe.y(r=>{(0,ae.parse)(t,{download:!0,header:!0,worker:!0,delimiter:";",complete:a=>r.next(a.data),error:a=>r.error(a)})})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Ne=Z(5074);let Fe=(()=>{class n{constructor(t){this.dataManager=t,this.historyChanged=new e.vpe}list(){var t;return null!==(t=this.dataManager.get(n.STORAGE_ID))&&void 0!==t?t:[]}add(t){let r=this.list();r=r.filter(a=>a!==t),r.unshift(t),r=r.slice(0,10),this.setHistory(r)}remove(t){const r=this.list().filter(a=>a!==t);this.setHistory(r)}clearAll(){this.dataManager.delete(n.STORAGE_ID),this.historyChanged.emit([])}setHistory(t){this.dataManager.set(n.STORAGE_ID,t),this.historyChanged.emit(t)}}return n.STORAGE_ID="remote-file-history",n.\u0275fac=function(t){return new(t||n)(e.LFG(Ne.L))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var je=Z(8505),Je=Z(1135);let Pe=(()=>{class n{constructor(){this.fileDrop=new e.vpe,this.dragOver=new Je.X(!1),this.preventBodyDrop=!0,this.active=!1}onDrop(t){t.preventDefault(),this.active=!1,this.dragOver.next(!1);const{dataTransfer:r}=t;if(!r)return;let a=[];r.items?(a=Array.from(r.items).filter(l=>"file"===l.kind).map(l=>l.getAsFile()).filter(l=>!!l),r.items.clear()):(a=Array.from(r.files),r.clearData()),this.fileDrop.emit(Array.from(a))}onDragOver(t){t.stopPropagation(),t.preventDefault(),this.active=!0,this.dragOver.next(!0)}onDragLeave(){this.active=!1,this.dragOver.next(!1)}onBodyDragOver(t){this.preventBodyDrop&&(t.preventDefault(),t.stopPropagation())}onBodyDrop(t){this.preventBodyDrop&&t.preventDefault()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=e.lG2({type:n,selectors:[["","scenariiDragAndDrop",""]],hostVars:2,hostBindings:function(t,r){1&t&&e.NdJ("drop",function(l){return r.onDrop(l)})("dragover",function(l){return r.onDragOver(l)})("dragleave",function(l){return r.onDragLeave(l)})("dragover",function(l){return r.onBodyDragOver(l)},!1,e.pYS)("drop",function(l){return r.onBodyDrop(l)},!1,e.pYS),2&t&&e.ekj("drop-zone-active",r.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"fileDrop",dragOver:"dragOver"}}),n})();var Ee=Z(9444);let Ye=(()=>{class n{transform(t,r=""){return t.map(a=>`${r}.${a}`).join(",")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=e.Yjl({name:"extensionList",type:n,pure:!0}),n})();function Ve(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",8),e.TgZ(1,"label",9),e.TgZ(2,"span"),e._uU(3,"Upload a file"),e.qZA(),e.TgZ(4,"input",10),e.NdJ("change",function(a){return e.CHM(t),e.oxw(2).onFileChange(a)}),e.ALo(5,"extensionList"),e.qZA(),e.qZA(),e.TgZ(6,"p",11),e._uU(7,"or drag and drop"),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(2);e.xp6(4),e.s9C("accept",e.lcZ(5,1,t.extensions))}}function Be(n,i){1&n&&(e.TgZ(0,"div",12),e._uU(1,"Drop the file here"),e.qZA())}function He(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e.NdJ("fileDrop",function(a){return e.CHM(t),e.oxw().onFileDropped(a)})("dragOver",function(a){return e.CHM(t),e.oxw().isOver=a}),e.TgZ(1,"div",3),e._UZ(2,"fa-icon",4),e.YNc(3,Ve,8,3,"div",5),e.YNc(4,Be,2,0,"ng-template",null,6,e.W1O),e.TgZ(6,"p",7),e._uU(7),e.ALo(8,"extensionList"),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.MAs(5),r=e.oxw();e.xp6(2),e.Q6J("icon",r.faFileUpload),e.xp6(1),e.Q6J("ngIf",!r.isOver)("ngIfElse",t),e.xp6(4),e.hij(" ",e.xi3(8,4,r.extensions,"*")," up to 10MB ")}}function Qe(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",13),e._uU(1," Currently selected: "),e.TgZ(2,"span",14),e._uU(3),e.qZA(),e.TgZ(4,"span",15),e._uU(5,"("),e.TgZ(6,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e._uU(7," remove"),e.qZA(),e._uU(8,")"),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.xp6(3),e.Oqu(null==t.file?null:t.file.name)}}let ze=(()=>{class n{constructor(){this.extensions=[],this.faFileUpload=K.Y9i,this.file=null,this.isOver=!1,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(t){t&&(this.file=t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}onFileChange(t){var r;this.file=(null===(r=t.target.files)||void 0===r?void 0:r[0])||null,this.onChange(this.file)}onClear(){this.file=null,this.onChange(null)}onFileDropped(t){const r=t[0];!r||(this.file=r,this.onChange(this.file))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-file-upload"]],inputs:{extensions:"extensions"},features:[e._Bn([{provide:T.JU,useExisting:(0,e.Gpc)(()=>n),multi:!0}])],decls:3,vars:2,consts:[["class","mt-6 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md","scenariiDragAndDrop","",3,"fileDrop","dragOver",4,"ngIf","ngIfElse"],["fileSelected",""],["scenariiDragAndDrop","",1,"mt-6","flex","justify-center","px-6","pt-5","pb-6","border-2","border-gray-300","border-dashed","rounded-md",3,"fileDrop","dragOver"],[1,"space-y-1","text-center","text-gray-600"],[1,"text-2xl",3,"icon"],["class","flex text-sm",4,"ngIf","ngIfElse"],["dragOver",""],[1,"text-xs","text-gray-500"],[1,"flex","text-sm"],["for","file-upload",1,"relative","cursor-pointer","bg-white","rounded-md","font-medium","text-indigo-600","hover:text-indigo-500","focus-within:outline-none","focus-within:ring-2","focus-within:ring-offset-2","focus-within:ring-indigo-500"],["id","file-upload","name","file-upload","type","file",1,"sr-only",3,"accept","change"],[1,"pl-1"],[1,"text-sm"],[1,"mt-3","text-sm","text-center","px-6","pt-5","pb-6","border-2","border-gray-300","border-dashed","rounded-sm","text-gray-400"],[1,"text-gray-800"],[1,"ml-3","text-sm"],[1,"relative","cursor-pointer","bg-white","rounded-md","font-medium","text-indigo-600","hover:text-indigo-500","focus-within:outline-none","focus-within:ring-2","focus-within:ring-offset-2","focus-within:ring-indigo-500",3,"click"]],template:function(t,r){if(1&t&&(e.YNc(0,He,9,7,"div",0),e.YNc(1,Qe,9,1,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",!r.file)("ngIfElse",a)}},directives:[H.O5,Pe,Ee.BN],pipes:[Ye],styles:[""]}),n})();function Ge(n,i){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.message," ")}}function We(n,i){if(1&n&&(e.TgZ(0,"div",1),e.YNc(1,Ge,2,1,"div",2),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null==t.control.errors?null:t.control.errors[t.errorName])}}let Le=(()=>{class n{constructor(){this.control=null,this.message="This field is invalid",this.errorName=null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-form-error"]],inputs:{control:"control",message:"message",errorName:"errorName"},decls:1,vars:1,consts:[["class","text-red-500",4,"ngIf"],[1,"text-red-500"],[4,"ngIf"]],template:function(t,r){1&t&&e.YNc(0,We,2,1,"div",0),2&t&&e.Q6J("ngIf",r.errorName&&r.control&&r.control&&r.control.invalid&&(r.control.dirty||r.control.touched))},directives:[H.O5],styles:[""]}),n})();const Ke=function(){return["csv"]};let pe=class{constructor(i,t,r,a,l){this.csvParser=t,this.fileHistory=r,this.route=a,this.router=l,this.csvUploaded=new e.vpe,this.faTimesCircle=K.nYk,this.currentFile=null,this.form=i.group({url:["",T.kI.pattern("https?://.{2,}")],file:[null,[_e(["text/csv","application/vnd.ms-excel","application/csv"])]]},{validators:[Ae(T.kI.required),de(T.kI.required)]}),this.route.queryParams.pipe(function B(n,i){return t=>{const r=x(i);return"string"==typeof i?function oe(n,i,t){const r=n[i];g(n,t),n[i]=function(){r.apply(this,arguments),P(this,t),n[i]=r}}(n,i,r):g(n,r),t.pipe(function h(n){return(0,J.e)((i,t)=>{(0,L.Xf)(n).subscribe(new N.Q(t,()=>t.complete(),M.Z)),!t.closed&&i.subscribe(t)})}(n[r]))}}(this)).subscribe(y=>{!y.url||this.form.patchValue({url:y.url})})}get url(){return this.form.get("url")}get file(){return this.form.get("file")}onSubmit(){(this.form.value.file?this.useLocalFile(this.form.value.file):this.useRemoteUrl(this.form.value.url)).subscribe(i=>{this.csvUploaded.emit(i)})}onClearUrl(){!this.url||(this.url.reset(),this.router.navigateByUrl("/load"))}useLocalFile(i){return this.csvParser.parseFile(i)}useRemoteUrl(i){return this.csvParser.parseURL(i).pipe((0,je.b)(()=>{this.fileHistory.add(i)}))}};pe.\u0275fac=function(i){return new(i||pe)(e.Y36(T.qu),e.Y36(qe),e.Y36(Fe),e.Y36(A.gz),e.Y36(A.F0))},pe.\u0275cmp=e.Xpm({type:pe,selectors:[["scenarii-csv-uploader"]],outputs:{csvUploaded:"csvUploaded"},decls:24,vars:15,consts:[[3,"formGroup","ngSubmit"],[1,"shadow","sm:rounded-md","sm:overflow-hidden"],[1,"px-4","py-5","bg-white","sm:p-6","space-y-6"],[1,"text-lg","font-medium","leading-6","text-gray-900"],[1,"text-sm","text-gray-500","mt-1","italic"],["name","file","formControlName","file",3,"extensions"],["errorName","requiredFileType","message","The selected file is not a CSV file.",3,"control"],[1,""],[1,"mt-1","flex","rounded-md","shadow-sm"],["type","text","name","url","placeholder","http://www.example.com","formControlName","url",1,"focus:ring-gray-500","focus:border-gray-500","flex-1","block","w-full","rounded-l-md","sm:text-sm","border-gray-300"],[1,"py-1","px-2.5","rounded-r-md","border-y","border-r","border-gray-300","focus:ring-gray-500","focus:border-gray-500","block","bg-gray-300","hover:bg-gray-200","text-gray-800",3,"click"],[3,"icon"],["errorName","pattern","message","The url is malformed.",3,"control"],[1,"px-4","py-3","bg-gray-50","text-right","sm:px-6"],["type","submit",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","text-sm","font-medium","rounded-md","text-white","bg-gray-600","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-indigo-500","disabled:bg-gray-200",3,"disabled"]],template:function(i,t){1&i&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"div"),e.TgZ(4,"h3",3),e._uU(5," Use a local file "),e.qZA(),e.TgZ(6,"p",4),e._uU(7," Select a file on your computer to upload or drop it. "),e.qZA(),e.qZA(),e._UZ(8,"scenarii-file-upload",5),e._UZ(9,"scenarii-form-error",6),e.TgZ(10,"div"),e.TgZ(11,"h3",3),e._uU(12," Or a remote file "),e.qZA(),e.TgZ(13,"p",4),e._uU(14," Fill an URL to download a remote CSV file. "),e.qZA(),e.qZA(),e.TgZ(15,"div",7),e.TgZ(16,"div",8),e._UZ(17,"input",9),e.TgZ(18,"button",10),e.NdJ("click",function(){return t.onClearUrl()}),e._UZ(19,"fa-icon",11),e.qZA(),e.qZA(),e._UZ(20,"scenarii-form-error",12),e.qZA(),e.qZA(),e.TgZ(21,"div",13),e.TgZ(22,"button",14),e._uU(23," Upload "),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(8),e.Q6J("extensions",e.DdM(14,Ke)),e.xp6(1),e.Q6J("control",t.file),e.xp6(8),e.ekj("focus:ring-red-500",null==t.url?null:t.url.invalid)("focus:border-red-500",null==t.url?null:t.url.invalid)("focus:border-red-300",null==t.url?null:t.url.invalid)("border-red-500",null==t.url?null:t.url.invalid),e.xp6(2),e.Q6J("icon",t.faTimesCircle),e.xp6(1),e.Q6J("control",t.url),e.xp6(2),e.Q6J("disabled",!t.form.valid))},directives:[T._Y,T.JL,T.sg,ze,T.JJ,T.u,Le,T.Fj,Ee.BN],styles:[""]}),pe=function be(n,i,t,r){var y,a=arguments.length,l=a<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(n,i,t,r);else for(var S=n.length-1;S>=0;S--)(y=n[S])&&(l=(a<3?y(l):a>3?y(i,t,l):y(i,t))||l);return a>3&&l&&Object.defineProperty(i,t,l),l}([function Y(n={}){return i=>{!function E(n){return!!n[O]}(i)?function X(n,i){n.prototype.ngOnDestroy=ie(n.prototype.ngOnDestroy,i)}(i,n):function W(n,i){const t=n.\u0275pipe;t.onDestroy=ie(t.onDestroy,i)}(i,n),function q(n){n.prototype[w]=!0}(i)}}(),function Se(n,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,i)}("design:paramtypes",[T.qu,qe,Fe,A.gz,A.F0])],pe);const $e=function(n){return{url:n}};function Xe(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"a",1),e._uU(2),e.qZA(),e.TgZ(3,"span",2),e._uU(4,"("),e.TgZ(5,"button",3),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return a.onRemove(a.url)}),e._uU(6," remove"),e.qZA(),e._uU(7,")"),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("queryParams",e.VKq(2,$e,t.url)),e.xp6(1),e.Oqu(t.url)}}let et=(()=>{class n{constructor(t){this.fileHistory=t,this.url=null}onRemove(t){this.fileHistory.remove(t)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Fe))},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-file-history-item"]],inputs:{url:"url"},decls:1,vars:1,consts:[[4,"ngIf"],["routerLink","/load",1,"cursor-pointer","text-indigo-600","hover:text-indigo-500","focus-within:outline-none","focus-within:ring-2","focus-within:ring-offset-2","focus-within:ring-indigo-500",3,"queryParams"],[1,"text-sm","italic","ml-2","text-gray-400"],[1,"cursor-pointer","italic","text-indigo-400","hover:text-indigo-500","focus-within:outline-none","focus-within:ring-2","focus-within:ring-offset-2","focus-within:ring-indigo-500",3,"click"]],template:function(t,r){1&t&&e.YNc(0,Xe,8,4,"ng-container",0),2&t&&e.Q6J("ngIf",r.url)},directives:[H.O5,A.yS],styles:[""]}),n})();function tt(n,i){if(1&n&&(e.TgZ(0,"li"),e._UZ(1,"scenarii-file-history-item",9),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("url",t)}}function nt(n,i){if(1&n&&(e.TgZ(0,"ol",7),e.YNc(1,tt,2,1,"li",8),e.qZA()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t)}}function rt(n,i){1&n&&(e.TgZ(0,"div",10),e._uU(1," No URL yet in your history "),e.qZA())}function it(n,i){if(1&n&&(e.ynx(0),e.YNc(1,nt,2,1,"ol",5),e.YNc(2,rt,2,0,"ng-template",null,6,e.W1O),e.BQk()),2&n){const t=i.ngIf,r=e.MAs(3);e.xp6(1),e.Q6J("ngIf",t.length>0)("ngIfElse",r)}}let ot=(()=>{class n{constructor(t){this.fileHistory=t,this.history$=this.fileHistory.historyChanged.pipe((0,v.O)(t.list()))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Fe))},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-file-history"]],decls:9,vars:3,consts:[[1,"shadow","sm:rounded-md","sm:overflow-hidden"],[1,"px-4","py-5","bg-white","sm:p-6","space-y-6"],[1,"text-lg","font-medium","leading-6","text-gray-900"],[1,"text-sm","text-gray-500","mt-1","italic"],[4,"ngIf"],["class","space-y-1 list-decimal mx-4",4,"ngIf","ngIfElse"],["noUrl",""],[1,"space-y-1","list-decimal","mx-4"],[4,"ngFor","ngForOf"],[3,"url"],[1,"text-gray-500","italic","text-center","text-sm","py-6"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div"),e.TgZ(3,"h3",2),e._uU(4," Select a file in your URL history "),e.qZA(),e.TgZ(5,"p",3),e._uU(6," We can only keep track of remote URL for now. "),e.qZA(),e.qZA(),e.YNc(7,it,4,2,"ng-container",4),e.ALo(8,"async"),e.qZA(),e.qZA()),2&t&&(e.xp6(7),e.Q6J("ngIf",e.lcZ(8,1,r.history$)))},directives:[H.O5,H.sg,et],pipes:[H.Ov],styles:[""]}),n})(),Me=(()=>{class n{constructor(t){this.csvConfiguration=t}csvToScenarios(t){const r=this.getConfiguration();return t.map(a=>this.csvToScenario(a,r))}scenariosToCSV(t){const r=this.getConfiguration();return t.map(a=>this.scenarioToCSV(a,r))}scenarioToCSV(t,r){return{[r.identifier]:t.scenario.id,[r.message]:t.scenario.message,[r.category||"category"]:t.scenario.category||"",[r.subcategory||"subcategory"]:t.scenario.subcategory||"",[r.comment||"comment"]:t.scenario.comment||"",[r.dependency||"dependency"]:t.scenario.dependency||"",[r.valid||"valid"]:void 0===t.report.valid?"":t.report.valid?"true":"false",[r.testerComment||"testerComment"]:t.report.comment||""}}csvToScenario(t,r){return{scenario:{id:this.getFieldValue(t,r.identifier),message:this.getFieldValue(t,r.message),category:this.getFieldValue(t,r.category),comment:this.getFieldValue(t,r.comment),dependency:this.getFieldValue(t,r.dependency),subcategory:this.getFieldValue(t,r.subcategory)},report:{comment:null,valid:{true:!0,false:!1,unknown:void 0}[this.getFieldValue(t,r.valid,"unknown")]}}}getFieldValue(t,r,a=""){return r?`${t[r]}`:a}getConfiguration(){return this.csvConfiguration.get("columns")}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(ce.j))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function st(n,i){if(1&n&&(e.TgZ(0,"option",8),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function at(n,i){if(1&n&&e._UZ(0,"scenarii-form-error",9),2&n){const t=e.oxw(2);e.Q6J("control",t.control)}}function lt(n,i){if(1&n&&(e.TgZ(0,"div",1),e.TgZ(1,"div",2),e.TgZ(2,"label",3),e._uU(3),e.qZA(),e.TgZ(4,"select",4),e.TgZ(5,"option",5),e._uU(6,"Select a column"),e.qZA(),e.YNc(7,st,2,2,"option",6),e.qZA(),e.qZA(),e.YNc(8,at,1,1,"scenarii-form-error",7),e.qZA()),2&n){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("for",t.fieldName),e.xp6(1),e.Oqu(t.label),e.xp6(1),e.Q6J("name",t.fieldName)("formControlName",t.fieldName),e.xp6(3),e.Q6J("ngForOf",t.columns),e.xp6(1),e.Q6J("ngIf",t.errorMessage)}}let ct=(()=>{class n{constructor(){this.fieldName=null,this.label="",this.form=null,this.control=null,this.errorMessage=null,this.columns=[]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-csv-configurator-field"]],inputs:{fieldName:"fieldName",label:"label",form:"form",control:"control",errorMessage:"errorMessage",columns:"columns"},decls:1,vars:1,consts:[["class","mb-3",3,"formGroup",4,"ngIf"],[1,"mb-3",3,"formGroup"],[1,"grid","grid-cols-4","gap-2"],[3,"for"],[1,"col-span-3","focus:ring-gray-500","focus:border-gray-500","flex-1","block","w-full","rounded","sm:text-sm","border-gray-300",3,"name","formControlName"],["value",""],[3,"value",4,"ngFor","ngForOf"],["errorName","required","message","You must set a column name for the identifier.",3,"control",4,"ngIf"],[3,"value"],["errorName","required","message","You must set a column name for the identifier.",3,"control"]],template:function(t,r){1&t&&e.YNc(0,lt,9,7,"div",0),2&t&&e.Q6J("ngIf",r.fieldName&&r.control&&r.form)},directives:[H.O5,T.JL,T.sg,T.EJ,T.JJ,T.u,T.YN,T.Kr,H.sg,Le],styles:[""]}),n})();function ut(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"form",2),e.NdJ("ngSubmit",function(){return e.CHM(t),e.oxw().onSubmit()}),e.TgZ(1,"div",3),e.TgZ(2,"div",4),e.TgZ(3,"div"),e.TgZ(4,"h3",5),e._uU(5," Select the matching field from your csv file "),e.qZA(),e.TgZ(6,"p",6),e._uU(7," For each needed field, select a column name from your csv. "),e.qZA(),e.qZA(),e.TgZ(8,"div",7),e._UZ(9,"scenarii-csv-configurator-field",8),e._UZ(10,"scenarii-csv-configurator-field",9),e._UZ(11,"scenarii-csv-configurator-field",10),e._UZ(12,"scenarii-csv-configurator-field",11),e._UZ(13,"scenarii-csv-configurator-field",12),e._UZ(14,"scenarii-csv-configurator-field",13),e.qZA(),e.qZA(),e.TgZ(15,"div",14),e.TgZ(16,"button",15),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e._uU(17," Cancel "),e.qZA(),e.TgZ(18,"button",16),e._uU(19," Save "),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(9),e.Q6J("control",t.identifier)("columns",t.columns)("form",t.form),e.xp6(1),e.Q6J("control",t.message)("columns",t.columns)("form",t.form),e.xp6(1),e.Q6J("control",t.category)("columns",t.columns)("form",t.form),e.xp6(1),e.Q6J("control",t.subcategory)("columns",t.columns)("form",t.form),e.xp6(1),e.Q6J("control",t.dependency)("columns",t.columns)("form",t.form),e.xp6(1),e.Q6J("control",t.comment)("columns",t.columns)("form",t.form),e.xp6(4),e.Q6J("disabled",!t.form.valid)}}function ft(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",3),e.TgZ(1,"div",4),e._uU(2," Your CSV file has no column. Please upload a CSV file with at least one column. "),e.qZA(),e.TgZ(3,"div",14),e.TgZ(4,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e._uU(5," Cancel "),e.qZA(),e.qZA(),e.qZA()}}let dt=(()=>{class n{constructor(t,r){this.scenarioConverter=r,this.csvContent=null,this.configurationUpdated=new e.vpe,this.scenarios=new e.vpe,this.cleared=new e.vpe,this.columns=[],this.form=t.group({identifier:["",T.kI.required],message:["",T.kI.required],category:[""],subcategory:[""],dependency:[""],comment:[""]})}get identifier(){return this.form.get("identifier")}get message(){return this.form.get("message")}get category(){return this.form.get("category")}get subcategory(){return this.form.get("subcategory")}get dependency(){return this.form.get("dependency")}get comment(){return this.form.get("comment")}ngOnChanges(t){!t.csvContent||(this.columns=Object.keys((this.csvContent||[])[0]).sort(),this.form.setValue({identifier:this.getFieldIfExisting(this.columns,"id"),message:this.getFieldIfExisting(this.columns,"message"),category:this.getFieldIfExisting(this.columns,"category"),subcategory:this.getFieldIfExisting(this.columns,"subcategory"),dependency:this.getFieldIfExisting(this.columns,"dependency"),comment:this.getFieldIfExisting(this.columns,"comment")}))}onClear(){this.cleared.next()}onSubmit(){var t,r,a,l,y,S;this.configurationUpdated.next({columns:{identifier:(null===(t=this.identifier)||void 0===t?void 0:t.value)||"id",message:(null===(r=this.message)||void 0===r?void 0:r.value)||"message",category:null===(a=this.category)||void 0===a?void 0:a.value,subcategory:null===(l=this.subcategory)||void 0===l?void 0:l.value,dependency:null===(y=this.dependency)||void 0===y?void 0:y.value,comment:null===(S=this.comment)||void 0===S?void 0:S.value}}),this.scenarios.next(this.scenarioConverter.csvToScenarios(this.csvContent||[]))}getFieldIfExisting(t,r){return t.includes(r)?r:""}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.qu),e.Y36(Me))},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-csv-configurator"]],inputs:{csvContent:"csvContent"},outputs:{configurationUpdated:"configurationUpdated",scenarios:"scenarios",cleared:"cleared"},features:[e.TTD],decls:3,vars:2,consts:[[3,"formGroup","ngSubmit",4,"ngIf","ngIfElse"],["noColumns",""],[3,"formGroup","ngSubmit"],[1,"shadow","sm:rounded-md","sm:overflow-hidden"],[1,"px-4","py-5","bg-white","sm:p-6","space-y-6"],[1,"text-lg","font-medium","leading-6","text-gray-900"],[1,"text-sm","text-gray-500","mt-1","italic"],[1,"mt-3"],["label","Identifier","fieldName","identifier","errorMessage","You must set a column name for the identifier.",3,"control","columns","form"],["label","Message","fieldName","message","errorMessage","You must set a column name for the message.",3,"control","columns","form"],["label","Category","fieldName","category",3,"control","columns","form"],["label","Subcategory","fieldName","subcategory",3,"control","columns","form"],["label","Denpendency","fieldName","dependency",3,"control","columns","form"],["label","Comment","fieldName","comment",3,"control","columns","form"],[1,"px-4","py-3","bg-gray-50","text-right","sm:px-6"],["type","button",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","text-sm","font-medium","rounded-md","text-gray-600","bg-gray-200","hover:bg-gray-400","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-indigo-500","disabled:bg-gray-200","mr-3",3,"click"],["type","submit",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","text-sm","font-medium","rounded-md","text-white","bg-gray-600","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-indigo-500","disabled:bg-gray-200",3,"disabled"],["type","button",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","text-sm","font-medium","rounded-md","text-white","bg-gray-600","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-indigo-500","disabled:bg-gray-200",3,"click"]],template:function(t,r){if(1&t&&(e.YNc(0,ut,20,20,"form",0),e.YNc(1,ft,6,0,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",r.columns.length>0)("ngIfElse",a)}},directives:[H.O5,T._Y,T.JL,T.sg,ct],styles:[""]}),n})(),pt=(()=>{class n{constructor(t,r){this.scenarios=t,this.configuration=r,this.faTrash=K.$aW}onReset(){this.scenarios.reset([]),this.configuration.clear()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(le.z),e.Y36(ce.j))},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-reset"]],decls:11,vars:1,consts:[[1,"shadow","sm:rounded-md","sm:overflow-hidden"],[1,"px-4","py-5","bg-white","sm:p-6","space-y-6"],[1,"text-lg","font-medium","leading-6","text-gray-900"],[1,"text-sm","text-gray-500","mt-1","italic"],[1,"px-4","py-3","bg-gray-50","text-right","sm:px-6"],["type","button",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","text-sm","font-medium","rounded-md","text-white","bg-gray-600","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-gray-500",3,"click"],[1,"mr-2",3,"icon"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div"),e.TgZ(3,"h3",2),e._uU(4," Reset the scenarios and reports. "),e.qZA(),e.TgZ(5,"p",3),e._uU(6," You will be be able to upload an other file, but you will lose all the current scenarios and reports. "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"div",4),e.TgZ(8,"button",5),e.NdJ("click",function(){return r.onReset()}),e._UZ(9,"fa-icon",6),e._uU(10," Reset "),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(9),e.Q6J("icon",r.faTrash))},directives:[Ee.BN],styles:["[_nghost-%COMP%]{display:contents}"]}),n})();var ht=Z(3900);let gt=(()=>{class n{build(t){return new Oe.y(r=>{r.next((0,ae.unparse)(t,{delimiter:";",quotes:!0,header:!0})),r.complete()})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),mt=(()=>{class n{constructor(t){this.zone=t}saveText(t,r,a="text/plain"){return new Oe.y(l=>{this.zone.runOutsideAngular(()=>{const y=new Blob([t],{type:a}),S=document.createElement("a"),ee=URL.createObjectURL(y);S.href=ee,S.download=r,document.body.appendChild(S),S.click(),setTimeout(function(){document.body.removeChild(S),window.URL.revokeObjectURL(ee),l.next(),l.complete()},0)})})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(e.R0b))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),_t=(()=>{class n{constructor(t,r,a,l){this.builder=t,this.scenarios=r,this.scenarioConverter=a,this.fileSaver=l,this.faFileExport=K.ca9}onExport(){const t=this.scenarioConverter.scenariosToCSV(this.scenarios.getAll());console.log("content",t),this.builder.build(t).pipe((0,ht.w)(r=>this.fileSaver.saveText(r,"report.csv"))).subscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(gt),e.Y36(le.z),e.Y36(Me),e.Y36(mt))},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-csv-exporter"]],decls:12,vars:1,consts:[[1,"shadow","sm:rounded-md","sm:overflow-hidden"],[1,"px-4","py-5","bg-white","sm:p-6","space-y-6"],[1,"text-lg","font-medium","leading-6","text-gray-900"],[1,"text-sm","text-gray-500","mt-1","italic"],[1,"px-4","py-3","bg-gray-50","text-right","sm:px-6"],["type","button",1,"inline-flex","justify-center","py-2","px-4","border","border-transparent","shadow-sm","text-sm","font-medium","rounded-md","text-white","bg-gray-600","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-gray-500",3,"click"],[1,"mr-2",3,"icon"]],template:function(t,r){1&t&&(e.TgZ(0,"form"),e.TgZ(1,"div",0),e.TgZ(2,"div",1),e.TgZ(3,"div"),e.TgZ(4,"h3",2),e._uU(5," Export the scenarios into a CSV file "),e.qZA(),e.TgZ(6,"p",3),e._uU(7," A download will be triggered in order to save the CSV file. "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"div",4),e.TgZ(9,"button",5),e.NdJ("click",function(){return r.onExport()}),e._UZ(10,"fa-icon",6),e._uU(11," Export "),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(10),e.Q6J("icon",r.faFileExport))},directives:[T._Y,T.JL,Ee.BN],styles:[""]}),n})();function yt(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",6),e.TgZ(2,"scenarii-csv-uploader",7),e.NdJ("csvUploaded",function(a){return e.CHM(t),e.oxw(2).currentFile=a}),e.qZA(),e._UZ(3,"scenarii-file-history"),e.qZA(),e.BQk()}}function vt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"scenarii-csv-configurator",8),e.NdJ("cleared",function(){return e.CHM(t),e.oxw(2).onClear()})("configurationUpdated",function(a){return e.CHM(t),e.oxw(2).onConfigurationUpdated(a)})("scenarios",function(a){return e.CHM(t),e.oxw(2).onScenarios(a)}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("csvContent",t.currentFile)}}function xt(n,i){if(1&n&&(e.ynx(0),e.YNc(1,yt,4,0,"ng-container",3),e.YNc(2,vt,1,1,"ng-template",null,5,e.W1O),e.BQk()),2&n){const t=e.MAs(3),r=e.oxw();e.xp6(1),e.Q6J("ngIf",!r.currentFile)("ngIfElse",t)}}function Ct(n,i){1&n&&(e.TgZ(0,"div",6),e._UZ(1,"scenarii-reset"),e._UZ(2,"scenarii-csv-exporter"),e.qZA())}const bt=[{path:"",component:(()=>{class n{constructor(t,r){this.scenarios=t,this.csvConfiguration=r,this.currentFile=null,this.isRunning=!1,this.isRunning=this.scenarios.getAll().length>0}onScenarios(t){this.currentFile=null,this.scenarios.reset(t),this.isRunning=!0}onConfigurationUpdated(t){this.csvConfiguration.reset(t)}onClear(){this.currentFile=null}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(le.z),e.Y36(ce.j))},n.\u0275cmp=e.Xpm({type:n,selectors:[["scenarii-loader"]],decls:8,vars:2,consts:[[1,"flex","flex-col","flex-auto"],[1,"p-3","flex-auto"],[3,"isRunning"],[4,"ngIf","ngIfElse"],["reset",""],["csvConfigurator",""],[1,"md:grid","md:grid-cols-2","md:gap-6"],[3,"csvUploaded"],[3,"csvContent","cleared","configurationUpdated","scenarios"]],template:function(t,r){if(1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"scenarii-title"),e._uU(2,"Load a file"),e.qZA(),e.TgZ(3,"main",1),e.TgZ(4,"scenarii-status",2),e.NdJ("isRunning",function(l){return r.isRunning=l}),e.qZA(),e.YNc(5,xt,4,2,"ng-container",3),e.YNc(6,Ct,3,0,"ng-template",null,4,e.W1O),e.qZA(),e.qZA()),2&t){const a=e.MAs(7);e.xp6(5),e.Q6J("ngIf",!r.isRunning)("ngIfElse",a)}},directives:[De.r,ge,H.O5,pe,ot,dt,pt,_t],styles:["[_nghost-%COMP%]{display:contents}"]}),n})()}];let wt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[A.Bz.forChild(bt)],A.Bz]}),n})(),Tt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[H.ez,Te.m,wt,T.UX]]}),n})()},3028:function(Ie,we){var Z,T;Z=function Te(){"use strict";var A="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==A?A:{},e=!A.document&&!!A.postMessage,le=e&&/blob:/i.test((A.location||{}).protocol),ce={},De=0,v={parse:function(s,o){var c=(o=o||{}).dynamicTyping||!1;if(F(c)&&(o.dynamicTypingFunction=c,c={}),o.dynamicTyping=c,o.transform=!!F(o.transform)&&o.transform,o.worker&&v.WORKERS_SUPPORTED){var f=function(){if(!v.WORKERS_SUPPORTED)return!1;var j,k,m=(j=A.URL||A.webkitURL||null,k=Te.toString(),v.BLOB_URL||(v.BLOB_URL=j.createObjectURL(new Blob(["(",k,")();"],{type:"text/javascript"})))),b=new A.Worker(m);return b.onmessage=Re,b.id=De++,ce[b.id]=b}();return f.userStep=o.step,f.userChunk=o.chunk,f.userComplete=o.complete,f.userError=o.error,o.step=F(o.step),o.chunk=F(o.chunk),o.complete=F(o.complete),o.error=F(o.error),delete o.worker,void f.postMessage({input:s,config:o,workerId:f.id})}var d=null;return"string"==typeof s?d=o.download?new he(o):new se(o):!0===s.readable&&F(s.read)&&F(s.on)?d=new xe(o):(A.File&&s instanceof File||s instanceof Object)&&(d=new ge(o)),d.stream(s)},unparse:function(s,o){var c=!1,f=!0,d=",",m="\r\n",b='"',j=b+b,k=!1,p=null,I=!1;!function(){if("object"==typeof o){if("string"!=typeof o.delimiter||v.BAD_DELIMITERS.filter(function(u){return-1!==o.delimiter.indexOf(u)}).length||(d=o.delimiter),("boolean"==typeof o.quotes||"function"==typeof o.quotes||Array.isArray(o.quotes))&&(c=o.quotes),"boolean"!=typeof o.skipEmptyLines&&"string"!=typeof o.skipEmptyLines||(k=o.skipEmptyLines),"string"==typeof o.newline&&(m=o.newline),"string"==typeof o.quoteChar&&(b=o.quoteChar),"boolean"==typeof o.header&&(f=o.header),Array.isArray(o.columns)){if(0===o.columns.length)throw new Error("Option columns is empty");p=o.columns}void 0!==o.escapeChar&&(j=o.escapeChar+b),"boolean"==typeof o.escapeFormulae&&(I=o.escapeFormulae)}}();var _=new RegExp(me(b),"g");if("string"==typeof s&&(s=JSON.parse(s)),Array.isArray(s)){if(!s.length||Array.isArray(s[0]))return re(null,s,k);if("object"==typeof s[0])return re(p||Object.keys(s[0]),s,k)}else if("object"==typeof s)return"string"==typeof s.data&&(s.data=JSON.parse(s.data)),Array.isArray(s.data)&&(s.fields||(s.fields=s.meta&&s.meta.fields),s.fields||(s.fields=Array.isArray(s.data[0])?s.fields:"object"==typeof s.data[0]?Object.keys(s.data[0]):[]),Array.isArray(s.data[0])||"object"==typeof s.data[0]||(s.data=[s.data])),re(s.fields||[],s.data||[],k);throw new Error("Unable to serialize unrecognized input");function re(u,D,R){var J="";"string"==typeof u&&(u=JSON.parse(u)),"string"==typeof D&&(D=JSON.parse(D));var N=Array.isArray(u)&&0<u.length,L=!Array.isArray(D[0]);if(N&&f){for(var M=0;M<u.length;M++)0<M&&(J+=d),J+=V(u[M],M);0<D.length&&(J+=m)}for(var h=0;h<D.length;h++){var O=N?u.length:D[h].length,E=!1,U=N?0===Object.keys(D[h]).length:0===D[h].length;if(R&&!N&&(E="greedy"===R?""===D[h].join("").trim():1===D[h].length&&0===D[h][0].length),"greedy"===R&&N){for(var w=[],x=0;x<O;x++)w.push(D[h][L?u[x]:x]);E=""===w.join("").trim()}if(!E){for(var g=0;g<O;g++)0<g&&!U&&(J+=d),J+=V(D[h][N&&L?u[g]:g],g);h<D.length-1&&(!R||0<O&&!U)&&(J+=m)}}return J}function V(u,D){if(null==u)return"";if(u.constructor===Date)return JSON.stringify(u).slice(1,25);!0===I&&"string"==typeof u&&null!==u.match(/^[=+\-@].*$/)&&(u="'"+u);var R=u.toString().replace(_,j);return"boolean"==typeof c&&c||"function"==typeof c&&c(u,D)||Array.isArray(c)&&c[D]||function(N,L){for(var M=0;M<L.length;M++)if(-1<N.indexOf(L[M]))return!0;return!1}(R,v.BAD_DELIMITERS)||-1<R.indexOf(d)||" "===R.charAt(0)||" "===R.charAt(R.length-1)?b+R+b:R}}};if(v.RECORD_SEP=String.fromCharCode(30),v.UNIT_SEP=String.fromCharCode(31),v.BYTE_ORDER_MARK="\ufeff",v.BAD_DELIMITERS=["\r","\n",'"',v.BYTE_ORDER_MARK],v.WORKERS_SUPPORTED=!e&&!!A.Worker,v.NODE_STREAM_INPUT=1,v.LocalChunkSize=10485760,v.RemoteChunkSize=5242880,v.DefaultDelimiter=",",v.Parser=be,v.ParserHandle=Ce,v.NetworkStreamer=he,v.FileStreamer=ge,v.StringStreamer=se,v.ReadableStreamStreamer=xe,A.jQuery){var ue=A.jQuery;ue.fn.parse=function(s){var o=s.config||{},c=[];return this.each(function(m){if("INPUT"!==ue(this).prop("tagName").toUpperCase()||"file"!==ue(this).attr("type").toLowerCase()||!A.FileReader||!this.files||0===this.files.length)return!0;for(var b=0;b<this.files.length;b++)c.push({file:this.files[b],inputElem:this,instanceConfig:ue.extend({},o)})}),f(),this;function f(){if(0!==c.length){var b,j,k,p=c[0];if(F(s.before)){var I=s.before(p.file,p.inputElem);if("object"==typeof I){if("abort"===I.action)return"AbortError",b=p.file,j=p.inputElem,k=I.reason,void(F(s.error)&&s.error({name:"AbortError"},b,j,k));if("skip"===I.action)return void d();"object"==typeof I.config&&(p.instanceConfig=ue.extend(p.instanceConfig,I.config))}else if("skip"===I)return void d()}var _=p.instanceConfig.complete;p.instanceConfig.complete=function(re){F(_)&&_(re,p.file,p.inputElem),d()},v.parse(p.file,p.instanceConfig)}else F(s.complete)&&s.complete()}function d(){c.splice(0,1),f()}}}function te(s){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(o){var c=Ze(o);c.chunkSize=parseInt(c.chunkSize),o.step||o.chunk||(c.chunkSize=null),this._handle=new Ce(c),(this._handle.streamer=this)._config=c}.call(this,s),this.parseChunk=function(o,c){if(this.isFirstChunk&&F(this._config.beforeFirstChunk)){var f=this._config.beforeFirstChunk(o);void 0!==f&&(o=f)}this.isFirstChunk=!1,this._halted=!1;var d=this._partialLine+o;this._partialLine="";var m=this._handle.parse(d,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var b=m.meta.cursor;this._finished||(this._partialLine=d.substring(b-this._baseIndex),this._baseIndex=b),m&&m.data&&(this._rowCount+=m.data.length);var j=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(le)A.postMessage({results:m,workerId:v.WORKER_ID,finished:j});else if(F(this._config.chunk)&&!c){if(this._config.chunk(m,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);m=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(m.data),this._completeResults.errors=this._completeResults.errors.concat(m.errors),this._completeResults.meta=m.meta),this._completed||!j||!F(this._config.complete)||m&&m.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),j||m&&m.meta.paused||this._nextChunk(),m}this._halted=!0},this._sendError=function(o){F(this._config.error)?this._config.error(o):le&&this._config.error&&A.postMessage({workerId:v.WORKER_ID,error:o,finished:!1})}}function he(s){var o;(s=s||{}).chunkSize||(s.chunkSize=v.RemoteChunkSize),te.call(this,s),this._nextChunk=e?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(c){this._input=c,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(o=new XMLHttpRequest,this._config.withCredentials&&(o.withCredentials=this._config.withCredentials),e||(o.onload=ne(this._chunkLoaded,this),o.onerror=ne(this._chunkError,this)),o.open(this._config.downloadRequestBody?"POST":"GET",this._input,!e),this._config.downloadRequestHeaders){var c=this._config.downloadRequestHeaders;for(var f in c)o.setRequestHeader(f,c[f])}this._config.chunkSize&&o.setRequestHeader("Range","bytes="+this._start+"-"+(this._start+this._config.chunkSize-1));try{o.send(this._config.downloadRequestBody)}catch(m){this._chunkError(m.message)}e&&0===o.status&&this._chunkError()}},this._chunkLoaded=function(){var f;4===o.readyState&&(o.status<200||400<=o.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:o.responseText.length,this._finished=!this._config.chunkSize||this._start>=(null===(f=o.getResponseHeader("Content-Range"))?-1:parseInt(f.substring(f.lastIndexOf("/")+1))),this.parseChunk(o.responseText)))},this._chunkError=function(c){this._sendError(new Error(o.statusText||c))}}function ge(s){var o,c;(s=s||{}).chunkSize||(s.chunkSize=v.LocalChunkSize),te.call(this,s);var f="undefined"!=typeof FileReader;this.stream=function(d){this._input=d,c=d.slice||d.webkitSlice||d.mozSlice,f?((o=new FileReader).onload=ne(this._chunkLoaded,this),o.onerror=ne(this._chunkError,this)):o=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var d=this._input;if(this._config.chunkSize){var m=Math.min(this._start+this._config.chunkSize,this._input.size);d=c.call(d,this._start,m)}var b=o.readAsText(d,this._config.encoding);f||this._chunkLoaded({target:{result:b}})},this._chunkLoaded=function(d){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(d.target.result)},this._chunkError=function(){this._sendError(o.error)}}function se(s){var o;te.call(this,s=s||{}),this.stream=function(c){return o=c,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var c,f=this._config.chunkSize;return f?(c=o.substring(0,f),o=o.substring(f)):(c=o,o=""),this._finished=!o,this.parseChunk(c)}}}function xe(s){te.call(this,s=s||{});var o=[],c=!0,f=!1;this.pause=function(){te.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){te.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(d){this._input=d,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){f&&1===o.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),o.length?this.parseChunk(o.shift()):c=!0},this._streamData=ne(function(d){try{o.push("string"==typeof d?d:d.toString(this._config.encoding)),c&&(c=!1,this._checkIsFinished(),this.parseChunk(o.shift()))}catch(m){this._streamError(m)}},this),this._streamError=ne(function(d){this._streamCleanUp(),this._sendError(d)},this),this._streamEnd=ne(function(){this._streamCleanUp(),f=!0,this._streamData("")},this),this._streamCleanUp=ne(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Ce(s){var o,c,f,d=Math.pow(2,53),m=-d,b=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,j=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,k=this,p=0,I=0,_=!1,re=!1,V=[],u={data:[],errors:[],meta:{}};if(F(s.step)){var D=s.step;s.step=function(h){if(u=h,N())J();else{if(J(),0===u.data.length)return;p+=h.data.length,s.preview&&p>s.preview?c.abort():(u.data=u.data[0],D(u,k))}}}function R(h){return"greedy"===s.skipEmptyLines?""===h.join("").trim():1===h.length&&0===h[0].length}function J(){if(u&&f&&(M("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+v.DefaultDelimiter+"'"),f=!1),s.skipEmptyLines)for(var h=0;h<u.data.length;h++)R(u.data[h])&&u.data.splice(h--,1);return N()&&function(){if(u)if(Array.isArray(u.data[0])){for(var E=0;N()&&E<u.data.length;E++)u.data[E].forEach(O);u.data.splice(0,1)}else u.data.forEach(O);function O(U,w){F(s.transformHeader)&&(U=s.transformHeader(U,w)),V.push(U)}}(),function(){if(!u||!s.header&&!s.dynamicTyping&&!s.transform)return u;function O(U,w){var x,q=s.header?{}:[];for(x=0;x<U.length;x++){var g=x,P=U[x];s.header&&(g=x>=V.length?"__parsed_extra":V[x]),s.transform&&(P=s.transform(P,g)),P=L(g,P),"__parsed_extra"===g?(q[g]=q[g]||[],q[g].push(P)):q[g]=P}return s.header&&(x>V.length?M("FieldMismatch","TooManyFields","Too many fields: expected "+V.length+" fields but parsed "+x,I+w):x<V.length&&M("FieldMismatch","TooFewFields","Too few fields: expected "+V.length+" fields but parsed "+x,I+w)),q}var E=1;return!u.data.length||Array.isArray(u.data[0])?(u.data=u.data.map(O),E=u.data.length):u.data=O(u.data,0),s.header&&u.meta&&(u.meta.fields=V),I+=E,u}()}function N(){return s.header&&0===V.length}function L(h,O){return E=h,s.dynamicTypingFunction&&void 0===s.dynamicTyping[E]&&(s.dynamicTyping[E]=s.dynamicTypingFunction(E)),!0===(s.dynamicTyping[E]||s.dynamicTyping)?"true"===O||"TRUE"===O||"false"!==O&&"FALSE"!==O&&(function(U){if(b.test(U)){var w=parseFloat(U);if(m<w&&w<d)return!0}return!1}(O)?parseFloat(O):j.test(O)?new Date(O):""===O?null:O):O;var E}function M(h,O,E,U){var w={type:h,code:O,message:E};void 0!==U&&(w.row=U),u.errors.push(w)}this.parse=function(h,O,E){if(s.newline||(s.newline=function(q,g){q=q.substring(0,1048576);var P=new RegExp(me(g)+"([^]*?)"+me(g),"gm"),z=(q=q.replace(P,"")).split("\r"),G=q.split("\n");if(1===z.length||1<G.length&&G[0].length<z[0].length)return"\n";for(var X=0,W=0;W<z.length;W++)"\n"===z[W][0]&&X++;return X>=z.length/2?"\r\n":"\r"}(h,s.quoteChar||'"')),f=!1,s.delimiter)F(s.delimiter)&&(s.delimiter=s.delimiter(h),u.meta.delimiter=s.delimiter);else{var w=function(q,g,P,z,G){var ie,X,W,Y;G=G||[",","\t","|",";",v.RECORD_SEP,v.UNIT_SEP];for(var oe=0;oe<G.length;oe++){var B=G[oe],fe=0,K=0,Ae=0;W=void 0;for(var de=new be({comments:z,delimiter:B,newline:g,preview:10}).parse(q),_e=0;_e<de.data.length;_e++)if(P&&R(de.data[_e]))Ae++;else{var ae=de.data[_e].length;K+=ae,void 0!==W?0<ae&&(fe+=Math.abs(ae-W),W=ae):W=ae}0<de.data.length&&(K/=de.data.length-Ae),(void 0===X||fe<=X)&&(void 0===Y||Y<K)&&1.99<K&&(X=fe,ie=B,Y=K)}return{successful:!!(s.delimiter=ie),bestDelimiter:ie}}(h,s.newline,s.skipEmptyLines,s.comments,s.delimitersToGuess);w.successful?s.delimiter=w.bestDelimiter:(f=!0,s.delimiter=v.DefaultDelimiter),u.meta.delimiter=s.delimiter}var x=Ze(s);return s.preview&&s.header&&x.preview++,o=h,c=new be(x),u=c.parse(o,O,E),J(),_?{meta:{paused:!0}}:u||{meta:{paused:!1}}},this.paused=function(){return _},this.pause=function(){_=!0,c.abort(),o=F(s.chunk)?"":o.substring(c.getCharIndex())},this.resume=function(){k.streamer._halted?(_=!1,k.streamer.parseChunk(o,!0)):setTimeout(k.resume,3)},this.aborted=function(){return re},this.abort=function(){re=!0,c.abort(),u.meta.aborted=!0,F(s.complete)&&s.complete(u),o=""}}function me(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function be(s){var o,c=(s=s||{}).delimiter,f=s.newline,d=s.comments,m=s.step,b=s.preview,j=s.fastMode,k=o=void 0===s.quoteChar?'"':s.quoteChar;if(void 0!==s.escapeChar&&(k=s.escapeChar),("string"!=typeof c||-1<v.BAD_DELIMITERS.indexOf(c))&&(c=","),d===c)throw new Error("Comment character same as delimiter");!0===d?d="#":("string"!=typeof d||-1<v.BAD_DELIMITERS.indexOf(d))&&(d=!1),"\n"!==f&&"\r"!==f&&"\r\n"!==f&&(f="\n");var p=0,I=!1;this.parse=function(_,re,V){if("string"!=typeof _)throw new Error("Input must be a string");var u=_.length,D=c.length,R=f.length,J=d.length,N=F(m),L=[],M=[],h=[],O=p=0;if(!_)return Y();if(j||!1!==j&&-1===_.indexOf(o)){for(var E=_.split(f),U=0;U<E.length;U++){if(p+=(h=E[U]).length,U!==E.length-1)p+=f.length;else if(V)return Y();if(!d||h.substring(0,J)!==d){if(N){if(L=[],G(h.split(c)),oe(),I)return Y()}else G(h.split(c));if(b&&b<=U)return L=L.slice(0,b),Y(!0)}}return Y()}for(var w=_.indexOf(c,p),x=_.indexOf(f,p),q=new RegExp(me(k)+me(o),"g"),g=_.indexOf(o,p);;)if(_[p]!==o)if(d&&0===h.length&&_.substring(p,p+J)===d){if(-1===x)return Y();x=_.indexOf(f,p=x+R),w=_.indexOf(c,p)}else if(-1!==w&&(w<x||-1===x))h.push(_.substring(p,w)),w=_.indexOf(c,p=w+D);else{if(-1===x)break;if(h.push(_.substring(p,x)),W(x+R),N&&(oe(),I))return Y();if(b&&L.length>=b)return Y(!0)}else for(g=p,p++;;){if(-1===(g=_.indexOf(o,g+1)))return V||M.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:L.length,index:p}),X();if(g===u-1)return X(_.substring(p,g).replace(q,o));if(o!==k||_[g+1]!==k){if(o===k||0===g||_[g-1]!==k){-1!==w&&w<g+1&&(w=_.indexOf(c,g+1)),-1!==x&&x<g+1&&(x=_.indexOf(f,g+1));var P=ie(-1===x?w:Math.min(w,x));if(_[g+1+P]===c){h.push(_.substring(p,g).replace(q,o)),_[p=g+1+P+D]!==o&&(g=_.indexOf(o,p)),w=_.indexOf(c,p),x=_.indexOf(f,p);break}var z=ie(x);if(_.substring(g+1+z,g+1+z+R)===f){if(h.push(_.substring(p,g).replace(q,o)),W(g+1+z+R),w=_.indexOf(c,p),g=_.indexOf(o,p),N&&(oe(),I))return Y();if(b&&L.length>=b)return Y(!0);break}M.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:L.length,index:p}),g++}}else g++}return X();function G(B){L.push(B),O=p}function ie(B){var fe=0;if(-1!==B){var K=_.substring(g+1,B);K&&""===K.trim()&&(fe=K.length)}return fe}function X(B){return V||(void 0===B&&(B=_.substring(p)),h.push(B),p=u,G(h),N&&oe()),Y()}function W(B){p=B,G(h),h=[],x=_.indexOf(f,p)}function Y(B){return{data:L,errors:M,meta:{delimiter:c,linebreak:f,aborted:I,truncated:!!B,cursor:O+(re||0)}}}function oe(){m(Y()),L=[],M=[]}},this.abort=function(){I=!0},this.getCharIndex=function(){return p}}function Re(s){var o=s.data,c=ce[o.workerId],f=!1;if(o.error)c.userError(o.error,o.file);else if(o.results&&o.results.data){var d={abort:function(){f=!0,Se(o.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Ue,resume:Ue};if(F(c.userStep)){for(var m=0;m<o.results.data.length&&(c.userStep({data:o.results.data[m],errors:o.results.errors,meta:o.results.meta},d),!f);m++);delete o.results}else F(c.userChunk)&&(c.userChunk(o.results,d,o.file),delete o.results)}o.finished&&!f&&Se(o.workerId,o.results)}function Se(s,o){var c=ce[s];F(c.userComplete)&&c.userComplete(o),c.terminate(),delete ce[s]}function Ue(){throw new Error("Not implemented.")}function Ze(s){if("object"!=typeof s||null===s)return s;var o=Array.isArray(s)?[]:{};for(var c in s)o[c]=Ze(s[c]);return o}function ne(s,o){return function(){s.apply(o,arguments)}}function F(s){return"function"==typeof s}return le&&(A.onmessage=function(s){var o=s.data;if(void 0===v.WORKER_ID&&o&&(v.WORKER_ID=o.workerId),"string"==typeof o.input)A.postMessage({workerId:v.WORKER_ID,results:v.parse(o.input,o.config),finished:!0});else if(A.File&&o.input instanceof File||o.input instanceof Object){var c=v.parse(o.input,o.config);c&&A.postMessage({workerId:v.WORKER_ID,results:c,finished:!0})}}),(he.prototype=Object.create(te.prototype)).constructor=he,(ge.prototype=Object.create(te.prototype)).constructor=ge,(se.prototype=Object.create(se.prototype)).constructor=se,(xe.prototype=Object.create(te.prototype)).constructor=xe,v},void 0!==(T=Z.apply(we,[]))&&(Ie.exports=T)}}]);